# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This repository packages developer tools as [Dev Container Features](https://containers.dev/implementors/features/). Features are self-contained units of installation code and configuration that can be added to devcontainers. Current features: `claude-code`, `uv`, `mise`. Features are published to the GitHub Container Registry on pushes to `main`.

## Development Commands

Requires `@devcontainers/cli` installed globally: `npm install -g @devcontainers/cli`

### Run tests

All tests for a specific feature (replace `<feature>` with `claude-code`, `uv`, `mise`, etc.):
```
devcontainer features test -f <feature>
```

Autogenerated tests only (smoke tests across base images, no scenarios):
```
devcontainer features test --skip-scenarios -f <feature> -i ubuntu:latest
```

Scenario tests only:
```
devcontainer features test -f <feature> --skip-autogenerated --skip-duplicated
```

Global scenario tests:
```
devcontainer features test --global-scenarios-only
```

## Architecture

Each feature lives under `src/<feature-name>/` with two required files:
- `devcontainer-feature.json` — metadata, options, VS Code extensions, mounts, install ordering
- `install.sh` — shell script executed during container build

Tests live under `test/<feature-name>/`:
- `scenarios.json` — defines named test scenarios, each specifying a base image and feature options
- `test.sh` — scenario test script using the `dev-container-features-test-lib` framework (`check` assertions + `reportResults`)
- `basic.sh` — standalone smoke test (plain bash, no test framework)

The release workflow (`release.yaml`) auto-generates `README.md` files for each feature via `devcontainers/action` and opens a PR with the generated docs.

## Conventions

- Install scripts use `/bin/sh` (not bash) for broader compatibility
- Install scripts should be idempotent (check if already installed before re-installing)
- Feature JSON uses `installsAfter` to declare ordering dependencies on other features
- The `mounts` field in feature JSON creates persistent volumes for configuration that should survive container rebuilds
- Install scripts handle curl installation across package managers (apt-get, apk, dnf, yum)
- When installing as root for a non-root user, use `su - "${USERNAME}" -c "..."` to run the installer
- Symlink binaries into `/usr/local/bin/` so they're on PATH in non-login shells
- `containerEnv.PATH` in feature JSON should include all directories needed for the tool and its managed binaries (e.g., shims directories)
